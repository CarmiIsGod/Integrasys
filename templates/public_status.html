{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/brand/imago-azul.png?v=2' %}">
  <link rel="shortcut icon" href="{% static 'img/brand/imago-azul.png?v=2' %}">
  <title>Estado de tu equipo</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:24px;line-height:1.5;background:#f9fafb;}
    .card{border:1px solid #e2e8f0;border-radius:16px;padding:24px 28px;max-width:820px;background:#fff;box-shadow:0 18px 40px rgba(15,23,42,0.08);page-break-inside:avoid;}
    .muted{color:#666}
    table{border-collapse:collapse;width:100%}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left}
    .identity{display:flex;justify-content:space-between;align-items:center;gap:24px;margin-bottom:18px;}
    .identity__brand{display:flex;flex-direction:column;gap:8px;}
    .identity__brand img{height:70px;width:auto;display:block;}
    .identity .qr{height:128px;width:128px;flex-shrink:0;border:1px solid #e2e8f0;border-radius:12px;padding:8px;background:#fff;}
    .status{display:inline-block;padding:4px 10px;border-radius:999px;background:#f2f2f2}
    .device-notes{font-size:13px;color:#475569;margin-top:2px;}
    .device-detail-label{font-weight:400;color:#1f2937;}
    .public-disclaimer{margin-top:20px;background:#f8fafc;border-radius:12px;padding:12px 16px;color:#475569;font-size:13px;line-height:1.4;text-align:center;}
    @media print {
      @page { size: A4; margin: 10mm; }
      body{margin:0;background:#fff;}
      .card{box-shadow:none;max-width:100%;border-radius:8px;padding:16px 18px;}
      .identity{margin-bottom:12px;}
      h1{margin:12px 0 8px;}
      table{font-size:12px;}
      .device-notes{font-size:12px;}
      ul{margin-top:6px;margin-bottom:10px;}
      .public-disclaimer{font-size:12px;margin-top:12px;padding:10px 12px;}
      .no-print{display:none}
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="identity">
      <div class="identity__brand">
        <img src="{% static 'img/brand/logo-company-color.png' %}" alt="Integrasys">
      </div>
      <img class="qr" src="./qr.png" width="120" height="120" alt="QR">
    </div>
    <h1>Folio {{ order.folio }}</h1>
    <div class="muted">Cliente: {{ order.customer.name|default:"-" }}</div>
    <div>
      <span class="muted">Equipos:</span>
      {% with devices=order.devices.all %}
        {% if devices %}
          <ul style="margin:4px 0 0 18px;padding:0;">
            {% for device in devices %}
              <li style="margin-bottom:6px;">
                <div>{{ device.brand }} {{ device.model }}{% if device.serial %} ({{ device.serial }}){% endif %}</div>
                <div class="device-notes">
                  Descripci&oacute;n / falla:
                  {% if device.notes %}
                    {{ device.notes }}
                  {% else %}
                    Falla no reportada.
                  {% endif %}
                </div>
                {% if device.password_notes %}
                  <div class="device-notes">
                    <span class="device-detail-label">Contrase&ntilde;a / PIN:</span> {{ device.password_notes }}
                  </div>
                {% endif %}
                {% if device.accessories_notes %}
                  <div class="device-notes">
                    <span class="device-detail-label">Accesorios:</span> {{ device.accessories_notes }}
                  </div>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <span class="muted">(sin dispositivos)</span>
        {% endif %}
      {% endwith %}
    </div>
    <p>Estado actual: <span class="status">{{ order.get_status_display }}</span></p>
    <h3>Historial</h3>
    <table>
      <thead><tr><th>Fecha</th><th>Estado</th></tr></thead>
      <tbody>
        {% for s in history %}
          <tr>
            <td>{{ s.created_at|date:"Y-m-d H:i" }}</td>
            <td>
              {% if s.from_status %}
                <small class="muted">De {{ s.get_from_status_display }} &rarr;</small><br>
              {% endif %}
              {{ s.get_status_display }}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="2">Sin cambios de estado aún.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="public-disclaimer" style="text-align:center;">
      <p style="white-space:pre-line;margin:0 0 10px 0;">
IMPORTANTE: Esta orden de trabajo es el medio por el cual se hara entrega del equipo que ha dejado a reparaci&oacute;n. NO SE HARA ENTREGA DE EQUIPO SIN LA ORDEN DE SERVICIO CORRESPONDIENTE. La empresa no se hace responsable por perdidas de informaci&oacute;n que no haya respaldado el cliente con anterioridad.
Se informa a nuestros clientes que, una vez notificados del diagn&oacute;stico o la reparaci&oacute;n de sus equipos, disponen de un plazo de 20 d&iacute;as naturales para recogerlos. Despu&eacute;s de ese per&iacute;odo, la responsabilidad de la empresa se limita y no nos hacemos responsables por da&ntilde;os y/o p&eacute;rdidas ocurridos a los equipos. Al aceptar nuestros servicios, el cliente acepta que es su responsabilidad tomar las medidas necesarias para asegurar su propiedad durante el tiempo que los equipos se encuentren en nuestras instalaciones. Este disclaimer forma parte integral de nuestros t&eacute;rminos y condiciones.
      </p>
      <p class="muted" style="margin:0 0 10px 0;">Puedes conservar esta p&aacute;gina o el c&oacute;digo QR para futuras consultas.</p>
      <p style="margin:0;">
        <a href="{% url 'receipt_pdf' token=order.token %}" target="_blank">Descargar recibo (PDF)</a>
      </p>
    </div>
  <p class="no-print"><button onclick="window.print()">Imprimir</button></p>
</body>
</html>

