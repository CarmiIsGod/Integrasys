{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Recibo - {{ order.folio }}</title>
  <style>
    @page { margin: 16mm 14mm; }
    body { font-family: "DejaVu Sans", "Segoe UI", Arial, sans-serif; font-size: 11pt; color: #111827; margin:0; }
    .wrapper { max-width: 640px; margin: 0 auto; }
    .section { margin-bottom: 12pt; }
    .section h2 { font-size: 12pt; margin: 0 0 4pt; }
    .muted { color:#6b7280; font-size:10pt; }
    .devices { margin:0; padding-left:18pt; }
    hr { border:none; border-top:1px solid #d1d5db; margin:8pt 0; }
    .qr img { width:110pt; height:110pt; }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="section" style="display:flex;justify-content:space-between;align-items:flex-start;gap:12pt;">
      <div>
        <h2>Recibo de recepción</h2>
        <p><strong>Folio:</strong> {{ order.folio }}</p>
        <p><strong>Fecha:</strong> {{ order.checkin_at|date:"Y-m-d H:i" }}</p>
      </div>
      <div class="qr">
        <img src="data:image/png;base64,{{ qr_b64 }}" alt="QR">
      </div>
    </div>
    <hr>
    <div class="section">
      <p><strong>Cliente:</strong> {{ order.customer.name|default:"-" }}</p>
      <p><strong>Tel&eacute;fono:</strong> {{ order.customer.phone|default:"-" }}{% if order.customer.alt_phone %} / {{ order.customer.alt_phone }}{% endif %}</p>
      <p><strong>Email:</strong> {{ order.customer.email|default:"-" }}</p>
      <hr>
    </div>
    <div class="section">
      <p><strong>Equipos:</strong></p>
      {% with devices=order.devices.all %}
        {% if devices %}
          <ul class="devices">
            {% for device in devices %}<li>{{ device.brand }} {{ device.model }}{% if device.serial %} ({{ device.serial }}){% endif %}</li>{% endfor %}
          </ul>
        {% else %}
          <p>(sin dispositivos)</p>
        {% endif %}
      {% endwith %}
      <hr>
    </div>
    <div class="section">
      <p><strong>Último estado:</strong></p>
      {% with last_entry=order.history.last %}
        {% if last_entry %}
          <p>Fecha: {{ last_entry.created_at|date:"Y-m-d H:i" }}</p>
          <p>Estado: {{ last_entry.get_status_display }}</p>
        {% else %}
          <p>(aún no hay historial)</p>
        {% endif %}
      {% endwith %}
      <hr>
    </div>
    <div class="section">
      <p><strong>Consulta en línea:</strong></p>
      <p class="muted">{{ public_url }}</p>
    </div>
    <p class="muted">Conserve este recibo.</p>
  </div>
</body>
</html>

