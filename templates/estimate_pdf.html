<!doctype html>
<html lang="es">
{% load money %}
<head>
  <meta charset="utf-8">
  <title>Cotizacion {{ order.folio }}</title>
  <style>
    body{font-family:DejaVu Sans,Helvetica,Arial,sans-serif;font-size:12px;color:#111827;margin:0;padding:32px}
    h1{font-size:22px;margin:0 0 12px 0}
    h2{font-size:16px;margin:16px 0 8px 0}
    p{margin:4px 0}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #d1d5db;padding:8px;text-align:left}
    th{background:#e5e7eb;font-weight:600}
    .totals{margin-top:16px;border:1px solid #d1d5db;border-radius:6px;padding:12px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;color:#065f46;background:#d1fae5;margin-left:8px}
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <h1>Cotizacion {{ order.folio }}{% if estimate.approved_at %}<span class="badge">Aprobada</span>{% elif estimate.declined_at %}<span class="badge" style="background:#fee2e2;color:#991b1b">Rechazada</span>{% endif %}</h1>
  <p><b>Cliente:</b> {{ order.device.customer.name }}</p>
  <p><b>Equipo:</b> {{ order.device.brand }} {{ order.device.model }}{% if order.device.serial %} ({{ order.device.serial }}){% endif %}</p>
  <p><b>Fecha:</b> {{ estimate.updated_at|date:"Y-m-d H:i" }}</p>
  {% if public_url %}<p class="muted">Vista en linea: {{ public_url }}</p>{% endif %}

  <h2>Partidas</h2>
  <table>
    <thead>
      <tr>
        <th>Descripcion</th>
        <th style="width:80px">Cantidad</th>
        <th style="width:100px">Unitario</th>
        <th style="width:100px">Importe</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.description }}</td>
        <td>{{ item.qty }}</td>
        <td>{{ item.unit_price|money }}</td>
        <td>{{ item.line_total|money }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="totals">
    <p><b>Subtotal:</b> {{ estimate.subtotal|default_if_none:0|money }}</p>
    <p><b>{{ tax_name }}:</b> {{ estimate.tax|default_if_none:0|money }}</p>
    <p><b>Total:</b> {{ estimate.total|default_if_none:0|money }}</p>
  </div>

  {% if note %}
  <h2>Nota</h2>
  <p style="white-space:pre-wrap">{{ note }}</p>
  {% endif %}
</body>
</html>
